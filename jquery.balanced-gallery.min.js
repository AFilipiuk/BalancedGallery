!function(t,e,i){function n(e,i){r=this,this.element=e,this.elementChildren=t(e).children("*"),this.options=t.extend({},s,i),this.options.autoResize&&(this.unadulteratedHtml=t(this.element).html(),this.unadulteratedCSS=this.getUnadulteratedCss(),this.unadulteratedOptions=t.extend({},this.options),this.setupAutoResize()),this.init(),this.createGallery()}var r,o="BalancedGallery",s={autoResize:!0,background:null,idealHeight:null,idealWidth:null,maintainOrder:!0,orientation:"horizontal",padding:5,shuffleUnorderedPartitions:!0,viewportHeight:null,viewportWidth:null},a=null;t.fn[o]=function(e){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new n(this,e))})},n.prototype.getUnadulteratedCss=function(){var e=t(this.element);return{width:e[0].style.width,height:e[0].style.height,background:e.css("background"),paddingLeft:e.css("padding-left"),paddingTop:e.css("padding-top"),overflow:e.css("overflow"),fontSize:e.css("font-size")}},n.prototype.setupAutoResize=function(){t(e).resize(function(){clearTimeout(a),a=setTimeout(function(){r.recreate()},500)})},n.prototype.recreate=function(){this.reset(),this.init(),this.createGallery()},n.prototype.reset=function(){t(this.element).html(this.unadulteratedHtml),t(this.element).css(this.unadulteratedCSS),this.options=t.extend({},this.unadulteratedOptions),this.elementChildren=t(this.element).children("*")},n.prototype.init=function(){null==this.options.viewportWidth&&(this.options.viewportWidth=t(this.element).width()),null==this.options.viewportHeight&&(this.options.viewportHeight=t(this.element).height()),null==this.options.idealWidth&&(this.options.idealWidth=t(this.element).width()/4),null==this.options.idealHeight&&(this.options.idealHeight=t(this.element).height()/2),null!=this.options.background&&t(this.element).css({background:this.options.background}),this.elementChildren.css({display:"inline-block",padding:0,margin:0});var e=this.options.padding+"px";t(this.element).css({fontSize:0,paddingTop:e,paddingLeft:e})},n.prototype.createGallery=function(){var t=this.options.orientation.toLowerCase();if("horizontal"==t)this.createHorizontalGallery();else{if("vertical"!=t)throw"BalancedGallery: Invalid Orientation.";this.createVerticalGallery()}},n.prototype.createHorizontalGallery=function(){var t,e,i;t=this.getRows(),0==t?this.fallbackToStandardSize():(e=this.getWidthWeights(),i=this.getPartitions(e,t),this.resizeHorizontalElements(i))},n.prototype.createVerticalGallery=function(){var t,e,i;t=this.getColumns(),e=this.getHeightWeights(),i=this.getPartitions(e,t),this.orientElementsVertically(i),this.resizeVerticalElements(i)},n.prototype.getRows=function(){return Math.round(this.collectiveIdealWidth()/(this.options.viewportWidth-this.options.padding))},n.prototype.getColumns=function(){return Math.round(this.collectiveIdealHeight()/(this.options.viewportHeight-this.options.padding))},n.prototype.collectiveIdealWidth=function(){var e=0;return this.elementChildren.each(function(){e+=r.idealWidth(t(this))}),e},n.prototype.collectiveIdealHeight=function(){var e=0;return this.elementChildren.each(function(){e+=r.idealHeight(t(this))}),e},n.prototype.idealWidth=function(t){return this.aspectRatio(t)*(this.options.idealHeight+this.options.padding)},n.prototype.idealHeight=function(t){return 1/this.aspectRatio(t)*(this.options.idealWidth+this.options.padding)},n.prototype.fallbackToStandardSize=function(){var e=this.options.idealHeight;this.elementChildren.each(function(){t(this).height(e),t(this).width(r.idealWidth(t(this)))})},n.prototype.getWidthWeights=function(){return this.elementChildren.map(function(){var e=parseInt(100*r.aspectRatio(t(this)));return{element:this,weight:e}})},n.prototype.getHeightWeights=function(){return this.elementChildren.map(function(){var e=parseInt(100*(1/r.aspectRatio(t(this))));return{element:this,weight:e}})},n.prototype.getPartitions=function(t,e){if(this.options.maintainOrder)return this.getOrderedPartition(t,e);var i=this.getUnorderedPartition(t,e);return this.options.shuffleUnorderedPartitions&&(i=this.shufflePartitions(i)),this.reorderElements(i),i},n.prototype.getOrderedPartition=function(t,e){var i=t.length;if(0>=e)return[];if(e>=i)return t.map(function(t,e){return[[e]]});var n=this.createSolutionTable(t,e);i-=1,e-=2;for(var r=[];e>=0;)r=[function(){for(var r=[],o=n[i-1][e]+1;i+1>o;o++)r.push(t[o]);return r}()].concat(r),i=n[i-1][e],e-=1;return[function(){for(var e=[],n=0;i+1>n;n++)e.push(t[n]);return e}()].concat(r)},n.prototype.createSolutionTable=function(t,e){for(var i=t.length,n=[],r=0;i>r;r++)n.push(function(){for(var t=[],i=0;e>i;i++)t.push(0);return t}());for(var o=[],s=0;i-1>s;s++)o.push(function(){var t;t=[];for(var i=0;e-1>i;i++)t.push(0);return t}());for(var a=0;i>a;a++)n[a][0]=t[a].weight+(0!=a?n[a-1][0]:0);for(var h=0;e>h;h++)n[0][h]=t[0].weight;for(var l=1;i>l;l++)for(var p=1;e>p;p++){var d=function(){for(var t=[],e=0;l>e;e++)t.push([Math.max(n[e][p-1],n[l][0]-n[e][0]),e]);return t.sort(function(t,e){return t[0]-e[0]})[0]}();n[l][p]=d[0],o[l-1][p-1]=d[1]}return o},n.prototype.getUnorderedPartition=function(t,e){for(var i=t.sort(function(t,e){return e.weight-t.weight}),n=new Array(e),o=0;e>o;o++)n[o]=[];for(var s=0;s<i.length;s++){for(var a=n[0],h=r.getPartitionWeight(a),l=0;l<n.length;l++){var p=r.getPartitionWeight(n[l]);h>p&&(a=n[l],h=p)}a.push(i[s])}return n},n.prototype.getPartitionWeight=function(e){var i=0;return t.each(e,function(t,e){i+=e.weight}),i},n.prototype.shufflePartitions=function(t){for(var e=0;e<t.length;e++)t[e]=r.shuffleArray(t[e]);return r.shuffleArray(t)},n.prototype.reorderElements=function(e){t(this.element).html("");for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)t(this.element).append(n[r].element)},n.prototype.resizeHorizontalElements=function(e){for(var n=r.options.padding,o=0;o<e.length;o++){for(var s=0,a=0;a<e[o].length;a++)s+=r.aspectRatio(t(e[o][a].element));for(var h=0;h<e[o].length;h++){var l=t(e[o][h].element),p=(this.options.viewportWidth-n)/s,d=parseInt(p),u=parseInt(d*r.aspectRatio(l))-n;l.width(u),l.height(d),l.css({margin:0,marginRight:n+"px",marginBottom:n+"px"})}}this.element!=i.body&&t(this.element).css({overflow:"scroll"})},n.prototype.resizeVerticalElements=function(e){for(var i=r.options.padding,n=0;n<e.length;n++){for(var o=0,s=0;s<e[n].length;s++)o+=1/r.aspectRatio(t(e[n][s].element));for(var a=0;a<e[n].length;a++){var h=t(e[n][a].element),l=(this.options.viewportHeight-i)/o,p=parseInt(l),d=parseInt(p*(1/r.aspectRatio(h)))-i;h.width(p),h.height(d),h.css({margin:0,marginRight:i+"px",marginBottom:i+"px"})}}t(".balanced-gallery-column").css({display:"inline-block",padding:0,margin:0}),t(this.container).width(function(){var e=0;return t(".balanced-gallery-column").each(function(){e+=t(this).width()}),e}()),t(this.element).parent().css({overflowX:"scroll"}),this.options.viewportHeight!=this.element.clientHeight&&(this.options.viewportHeight=this.element.clientHeight-this.options.padding,t(this.element).height(this.options.viewportHeight-this.options.padding),this.resizeVerticalElements(e))},n.prototype.orientElementsVertically=function(e){var n=t(this.element);if(n.html(""),n.css({overflow:"scroll"}),this.element!=i.body){var r=t('<div id="balanced-gallery-col-container"></div>');n.append(r[0])}else var r=t(this.element);this.container=r[0];for(var o=0;o<e.length;o++){var s="balanced-gallery-col"+o,a='<div class="balanced-gallery-column" id="'+s+'"></div>';r.append(a);for(var h=0;h<e[o].length;h++){var l=e[o][h].element,p=t(r.find("div#"+s));p.append(l).append("<br />")}}},n.prototype.aspectRatio=function(t){var e=this.options.padding;return(t.width()+e)/(t.height()+e)},n.prototype.shuffleArray=function(t){for(var e,i,n=t.length;n--;)i=0|Math.random()*n,e=t[n],t[n]=t[i],t[i]=e;return t}}(jQuery,window,document);