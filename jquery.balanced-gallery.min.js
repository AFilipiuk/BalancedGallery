!function(t,e,n){function i(e,n){I=this,this.element=e,this.elementChildren=t(e).children("*"),this.options=t.extend({},T,n),this.options.autoResize&&(this.unadulteratedHtml=t(this.element).html(),this.unadulteratedCSS=r(),this.unadulteratedOptions=t.extend({},this.options),o()),this.init(),this.createGallery()}function r(){var e=t(I.element);return{width:e[0].style.width,height:e[0].style.height,background:e.css("background"),paddingLeft:e.css("padding-left"),paddingTop:e.css("padding-top"),overflow:e.css("overflow"),fontSize:e.css("font-size")}}function o(){t(e).resize(function(){clearTimeout(G),G=setTimeout(function(){I.recreate()},500)})}function a(){var t,e,n;t=h(),0==t?I.fallbackToStandardSize():(e=f(),n=v(e,t),S(n))}function l(){var t,e,n;t=s(),0==t?I.fallbackToStandardSize():(e=g(),n=v(e,t),z(n),k(n))}function h(){return Math.round(d()/(I.options.viewportWidth-I.options.padding))}function s(){return Math.round(u()/(I.options.viewportHeight-I.options.padding))}function d(){var e=0;return I.elementChildren.each(function(){e+=c(t(this))}),e}function u(){var e=0;return I.elementChildren.each(function(){e+=p(t(this))}),e}function c(t){return W(t)*(I.options.idealHeight+I.options.padding)}function p(t){return 1/W(t)*(I.options.idealWidth+I.options.padding)}function f(){return I.elementChildren.map(function(){var e=parseInt(100*W(t(this)));return{element:this,weight:e}})}function g(){return I.elementChildren.map(function(){var e=parseInt(100*(1/W(t(this))));return{element:this,weight:e}})}function v(t,e){if(I.options.maintainOrder)return m(t,e);var n=y(t,e);return I.options.shuffleUnorderedPartitions&&(n=H(n)),C(n),n}function m(t,e){var n=t.length;if(0>=e)return[];if(e>=n)return t.map(function(t,e){return[[e]]});var i=w(t,e);n-=1,e-=2;for(var r=[];e>=0;)r=[function(){for(var r=[],o=i[n-1][e]+1;n+1>o;o++)r.push(t[o]);return r}()].concat(r),n=i[n-1][e],e-=1;return[function(){for(var e=[],i=0;n+1>i;i++)e.push(t[i]);return e}()].concat(r)}function w(t,e){for(var n=t.length,i=[],r=0;n>r;r++)i.push(function(){for(var t=[],n=0;e>n;n++)t.push(0);return t}());for(var o=[],a=0;n-1>a;a++)o.push(function(){var t;t=[];for(var n=0;e-1>n;n++)t.push(0);return t}());for(var l=0;n>l;l++)i[l][0]=t[l].weight+(0!=l?i[l-1][0]:0);for(var h=0;e>h;h++)i[0][h]=t[0].weight;for(var s=1;n>s;s++)for(var d=1;e>d;d++){var u=function(){for(var t=[],e=0;s>e;e++)t.push([Math.max(i[e][d-1],i[s][0]-i[e][0]),e]);return t.sort(function(t,e){return t[0]-e[0]})[0]}();i[s][d]=u[0],o[s-1][d-1]=u[1]}return o}function y(t,e){for(var n=t.sort(function(t,e){return e.weight-t.weight}),i=new Array(e),r=0;e>r;r++)i[r]=[];for(var o=0;o<n.length;o++){for(var a=i[0],l=b(a),h=0;h<i.length;h++){var s=b(i[h]);l>s&&(a=i[h],l=s)}a.push(n[o])}return i}function b(e){var n=0;return t.each(e,function(t,e){n+=e.weight}),n}function H(t){for(var e=0;e<t.length;e++)t[e]=x(t[e]);return x(t)}function C(e){t(I.element).html("");for(var n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.length;r++)t(I.element).append(i[r].element)}function S(e){for(var i=I.options.padding,r=0;r<e.length;r++){for(var o=0,a=0;a<e[r].length;a++)o+=W(t(e[r][a].element));for(var l=0;l<e[r].length;l++){var h=t(e[r][l].element),s=(I.options.viewportWidth-i)/o,d=parseInt(s),u=parseInt(d*W(h))-i;h.width(u),h.height(d),h.css({margin:0,marginRight:i+"px",marginBottom:i+"px"})}}I.element!=n.body&&t(I.element).css({overflow:"scroll"})}function k(e){for(var i=I.options.padding,r=0;r<e.length;r++){for(var o=0,a=0;a<e[r].length;a++)o+=1/W(t(e[r][a].element));for(var l=0;l<e[r].length;l++){var h=t(e[r][l].element),s=(I.options.viewportHeight-i)/o,d=parseInt(s),u=parseInt(d*(1/W(h)))-i;h.width(d),h.height(u),h.css({margin:0,marginRight:i+"px",marginBottom:i+"px"})}}t(".balanced-gallery-column").css({display:"inline-block",padding:0,margin:0}),t(I.container).width(function(){var e=0;return t(".balanced-gallery-column").each(function(){e+=t(this).width()}),e}()),I.element!=n.body&&t(I.element).css({overflowY:"hidden"}),I.options.viewportHeight!=I.element.clientHeight&&(I.options.viewportHeight=I.element.clientHeight-I.options.padding,t(I.element).height(I.options.viewportHeight-I.options.padding),I.element==n.body&&k(e))}function z(e){var i=t(I.element);if(i.html(""),i.css({overflow:"scroll"}),I.element!=n.body){var r=t('<div id="balanced-gallery-col-container"></div>');i.append(r[0])}else var r=t(I.element);I.container=r[0];for(var o=0;o<e.length;o++){var a="balanced-gallery-col"+o,l='<div class="balanced-gallery-column" id="'+a+'"></div>';r.append(l);for(var h=0;h<e[o].length;h++){var s=e[o][h].element,d=t(r.find("div#"+a));d.append(s).append("<br />")}}}function W(t){var e=I.options.padding;return(t.width()+e)/(t.height()+e)}function x(t){for(var e,n,i=t.length;i--;)n=0|Math.random()*i,e=t[i],t[i]=t[n],t[n]=e;return t}var I,L="BalancedGallery",T={autoResize:!0,background:null,idealHeight:null,idealWidth:null,maintainOrder:!0,orientation:"horizontal",padding:5,shuffleUnorderedPartitions:!0,viewportHeight:null,viewportWidth:null},O="ALL_CHILDREN_LOADED",G=null;t.fn[L]=function(e){return this.each(function(){t.data(this,"plugin_"+L)||t.data(this,"plugin_"+L,new i(this,e))})},i.prototype.recreate=function(){t(this.element).on(O,function(){I.init(),I.createGallery()}),this.reset()},i.prototype.reset=function(){var e=this.elementChildren.length;t(this.element).html(this.unadulteratedHtml),t(this.element).css(this.unadulteratedCSS),this.options=t.extend({},this.unadulteratedOptions),this.elementChildren=t(this.element).children("*");var n=0;this.elementChildren.each(function(){t(this).load(function(){++n==e&&t(I.element).trigger(O)})})},i.prototype.init=function(){null==this.options.viewportWidth&&(this.options.viewportWidth=t(this.element).width()),null==this.options.viewportHeight&&(this.options.viewportHeight=t(this.element).height()),null==this.options.idealWidth&&(this.options.idealWidth=t(this.element).width()/4),null==this.options.idealHeight&&(this.options.idealHeight=t(this.element).height()/2),null!=this.options.background&&t(this.element).css({background:this.options.background}),this.elementChildren.css({display:"inline-block",padding:0,margin:0});var e=this.options.padding+"px";t(this.element).css({fontSize:0,paddingTop:e,paddingLeft:e})},i.prototype.createGallery=function(){var t=this.options.orientation.toLowerCase();if("horizontal"==t)a();else{if("vertical"!=t)throw"BalancedGallery: Invalid Orientation.";l()}},i.prototype.fallbackToStandardSize=function(){var e=this.options.idealHeight;this.elementChildren.each(function(){t(this).height(e),t(this).width(I.idealWidth(t(this)))})}}(jQuery,window,document);