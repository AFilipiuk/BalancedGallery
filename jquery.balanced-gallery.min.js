!function(t,n,e){function i(n,e){I=this,this.element=n,this.elementChildren=t(n).children("*"),this.options=t.extend({},T,e),this.options.autoResize&&(this.unadulteratedHtml=t(this.element).html(),this.unadulteratedCSS=r(),this.unadulteratedOptions=t.extend({},this.options),o()),this.init(),this.createGallery()}function r(){var n=t(I.element);return{width:n[0].style.width,height:n[0].style.height,background:n.css("background"),paddingLeft:n.css("padding-left"),paddingTop:n.css("padding-top"),overflow:n.css("overflow"),fontSize:n.css("font-size")}}function o(){t(n).resize(function(){clearTimeout(G),G=setTimeout(function(){I.recreate()},500)})}function a(){var t,n,e;t=h(),0==t?I.fallbackToStandardSize():(n=f(),e=v(n,t),S(e))}function l(){var t,n,e;t=s(),0==t?I.fallbackToStandardSize():(n=g(),e=v(n,t),z(e),k(e))}function h(){return Math.round(d()/(I.options.viewportWidth-I.options.padding))}function s(){return Math.round(u()/(I.options.viewportHeight-I.options.padding))}function d(){var n=0;return I.elementChildren.each(function(){n+=c(t(this))}),n}function u(){var n=0;return I.elementChildren.each(function(){n+=p(t(this))}),n}function c(t){return W(t)*(I.options.idealHeight+I.options.padding)}function p(t){return 1/W(t)*(I.options.idealWidth+I.options.padding)}function f(){return I.elementChildren.map(function(){var n=parseInt(100*W(t(this)));return{element:this,weight:n}})}function g(){return I.elementChildren.map(function(){var n=parseInt(100*(1/W(t(this))));return{element:this,weight:n}})}function v(t,n){if(I.options.maintainOrder)return m(t,n);var e=y(t,n);return I.options.shuffleUnorderedPartitions&&(e=H(e)),C(e),e}function m(t,n){var e=t.length;if(0>=n)return[];if(n>=e)return t.map(function(t,n){return[[n]]});var i=w(t,n);e-=1,n-=2;for(var r=[];n>=0;)r=[function(){for(var r=[],o=i[e-1][n]+1;e+1>o;o++)r.push(t[o]);return r}()].concat(r),e=i[e-1][n],n-=1;return[function(){for(var n=[],i=0;e+1>i;i++)n.push(t[i]);return n}()].concat(r)}function w(t,n){for(var e=t.length,i=[],r=0;e>r;r++)i.push(function(){for(var t=[],e=0;n>e;e++)t.push(0);return t}());for(var o=[],a=0;e-1>a;a++)o.push(function(){var t;t=[];for(var e=0;n-1>e;e++)t.push(0);return t}());for(var l=0;e>l;l++)i[l][0]=t[l].weight+(0!=l?i[l-1][0]:0);for(var h=0;n>h;h++)i[0][h]=t[0].weight;for(var s=1;e>s;s++)for(var d=1;n>d;d++){var u=function(){for(var t=[],n=0;s>n;n++)t.push([Math.max(i[n][d-1],i[s][0]-i[n][0]),n]);return t.sort(function(t,n){return t[0]-n[0]})[0]}();i[s][d]=u[0],o[s-1][d-1]=u[1]}return o}function y(t,n){for(var e=t.sort(function(t,n){return n.weight-t.weight}),i=new Array(n),r=0;n>r;r++)i[r]=[];for(var o=0;o<e.length;o++){for(var a=i[0],l=b(a),h=0;h<i.length;h++){var s=b(i[h]);l>s&&(a=i[h],l=s)}a.push(e[o])}return i}function b(n){var e=0;return t.each(n,function(t,n){e+=n.weight}),e}function H(t){for(var n=0;n<t.length;n++)t[n]=x(t[n]);return x(t)}function C(n){t(I.element).html("");for(var e=0;e<n.length;e++)for(var i=n[e],r=0;r<i.length;r++)t(I.element).append(i[r].element)}function S(n){for(var i=I.options.padding,r=0;r<n.length;r++){for(var o=0,a=0;a<n[r].length;a++)o+=W(t(n[r][a].element));for(var l=0;l<n[r].length;l++){var h=t(n[r][l].element),s=(I.options.viewportWidth-i)/o,d=parseInt(s),u=parseInt(d*W(h))-i;h.width(u),h.height(d),h.css({margin:0,marginRight:i+"px",marginBottom:i+"px"})}}I.element!=e.body&&t(I.element).css({overflow:"scroll"})}function k(n){for(var e=I.options.padding,i=0;i<n.length;i++){for(var r=0,o=0;o<n[i].length;o++)r+=1/W(t(n[i][o].element));for(var a=0;a<n[i].length;a++){var l=t(n[i][a].element),h=(I.options.viewportHeight-e)/r,s=parseInt(h),d=parseInt(s*(1/W(l)))-e;l.width(s),l.height(d),l.css({margin:0,marginRight:e+"px",marginBottom:e+"px"})}}t(".balanced-gallery-column").css({display:"inline-block",padding:0,margin:0}),t(I.container).width(function(){var n=0;return t(".balanced-gallery-column").each(function(){n+=t(this).width()}),n}()),t(I.element).parent().css({overflowX:"scroll"}),I.options.viewportHeight!=I.element.clientHeight&&(I.options.viewportHeight=I.element.clientHeight-I.options.padding,t(I.element).height(I.options.viewportHeight-I.options.padding),k(n))}function z(n){var i=t(I.element);if(i.html(""),i.css({overflow:"scroll"}),I.element!=e.body){var r=t('<div id="balanced-gallery-col-container"></div>');i.append(r[0])}else var r=t(I.element);I.container=r[0];for(var o=0;o<n.length;o++){var a="balanced-gallery-col"+o,l='<div class="balanced-gallery-column" id="'+a+'"></div>';r.append(l);for(var h=0;h<n[o].length;h++){var s=n[o][h].element,d=t(r.find("div#"+a));d.append(s).append("<br />")}}}function W(t){var n=I.options.padding;return(t.width()+n)/(t.height()+n)}function x(t){for(var n,e,i=t.length;i--;)e=0|Math.random()*i,n=t[i],t[i]=t[e],t[e]=n;return t}var I,L="BalancedGallery",T={autoResize:!0,background:null,idealHeight:null,idealWidth:null,maintainOrder:!0,orientation:"horizontal",padding:5,shuffleUnorderedPartitions:!0,viewportHeight:null,viewportWidth:null},O="ALL_CHILDREN_LOADED",G=null;t.fn[L]=function(n){return this.each(function(){t.data(this,"plugin_"+L)||t.data(this,"plugin_"+L,new i(this,n))})},i.prototype.recreate=function(){t(this.element).on(O,function(){I.init(),I.createGallery()}),this.reset()},i.prototype.reset=function(){var n=this.elementChildren.length;t(this.element).html(this.unadulteratedHtml),t(this.element).css(this.unadulteratedCSS),this.options=t.extend({},this.unadulteratedOptions),this.elementChildren=t(this.element).children("*");var e=0;this.elementChildren.each(function(){t(this).load(function(){++e==n&&t(I.element).trigger(O)})})},i.prototype.init=function(){null==this.options.viewportWidth&&(this.options.viewportWidth=t(this.element).width()),null==this.options.viewportHeight&&(this.options.viewportHeight=t(this.element).height()),null==this.options.idealWidth&&(this.options.idealWidth=t(this.element).width()/4),null==this.options.idealHeight&&(this.options.idealHeight=t(this.element).height()/2),null!=this.options.background&&t(this.element).css({background:this.options.background}),this.elementChildren.css({display:"inline-block",padding:0,margin:0});var n=this.options.padding+"px";t(this.element).css({fontSize:0,paddingTop:n,paddingLeft:n})},i.prototype.createGallery=function(){var t=this.options.orientation.toLowerCase();if("horizontal"==t)a();else{if("vertical"!=t)throw"BalancedGallery: Invalid Orientation.";l()}},i.prototype.fallbackToStandardSize=function(){var n=this.options.idealHeight;this.elementChildren.each(function(){t(this).height(n),t(this).width(I.idealWidth(t(this)))})}}(jQuery,window,document);